Index: sbin/luactl/luactl.8
===================================================================
RCS file: /cvsroot/src/sbin/luactl/luactl.8,v
retrieving revision 1.4
diff -r1.4 luactl.8
42a43,46
> .Nm
> .Op Fl cq
> .Cm openlibs
> .Ar name
105a110,112
> .It Cm openlibs Ar name
> Load Lua standard libraries into the Lua state
> .Ar name .
Index: sbin/luactl/luactl.c
===================================================================
RCS file: /cvsroot/src/sbin/luactl/luactl.c,v
retrieving revision 1.2
diff -r1.2 luactl.c
60a61,62
> static void openlibs(char *);
> 
112a115,120
> 	} else if (!strcmp(argv[0], "openlibs")) {
> 		if (argc != 2)
> 			usage();
> 		if (docreate)
> 			create(argv[1], NULL);
>         openlibs(argv[1]);
200a209,224
> openlibs(char *name)
> {
> 	struct lua_require o;
> 
> 	strlcpy(o.state, name, sizeof(o.state));
> 
> 	if (ioctl(devfd, LUAOPENLIBS, &o) == -1)
> 		err(EXIT_FAILURE, "LUAOPENLIBS");
> 
> 	if (quiet)
> 		return;
> 
> 	printf("standard libraries opened by %s\n", name);
> }
> 
> static void
227a252
> 	fprintf(stderr, "       %s [-cq] openlibs name\n", p);
Index: sys/modules/lua/lua.c
===================================================================
RCS file: /cvsroot/src/sys/modules/lua/lua.c,v
retrieving revision 1.16
diff -r1.16 lua.c
51a52
> #include <lualib.h>
281a283
> 	struct lua_require *openlibs;
382a385,401
>     case LUAOPENLIBS:
> 		openlibs = data;
> 		LIST_FOREACH(s, &lua_states, lua_next)
> 			if (!strcmp(s->lua_name, openlibs->state)) {
> 				if (lua_verbose)
> 					device_printf(
> 						sc->sc_dev,
> 					    "opening standard libraries "
> 					    "%s to state %s\n",
> 					    m->mod_name,
> 					    s->lua_name);
> 				klua_lock(s->K);
>                 luaL_openlibs(s->K->L);
> 				klua_unlock(s->K);
> 				return 0;
> 			}
> 		return ENXIO;
Index: sys/sys/lua.h
===================================================================
RCS file: /cvsroot/src/sys/sys/lua.h,v
retrieving revision 1.7
diff -r1.7 lua.h
83a84,85
> #define LUAOPENLIBS	_IOWR('1', 5, struct lua_require)
> 
